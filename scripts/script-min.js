function getMessages(e){var t={timestamp:e};$.ajax({type:"get",url:"request_new.php",data:t,contentType:"application/json;charset=utf-8",success:function(e){for(var t=e.messages,n="",o=0;o<t.length;o++)n+='<div class="message-container"><span id="time">'+toText(t[o].eventtime)+'</span>   <span id="location">'+toText(t[o].location_name)+"-"+t[o].location_address+'</span><br><span id="info">'+toText(t[o].info)+'</span><br><span id="Email">'+toText(t[o].email_address)+"</span><br><a href=/post.html?id="+toText(t[o].idpost)+">Continue</a></div>";document.getElementById("data").innerHTML=n,getMessages(e.timestamp)}})}function getMessage(e){var t={timestamp:0};$.ajax({type:"get",url:"request_new.php",data:t,contentType:"application/json;charset=utf-8",success:function(t){for(var n,o=t.messages,a=0;a<o.length;a++)if(o[a].idpost==e){n=o[a],initMap(o[a].location_id);break}document.getElementById("post_count").innerHTML=toText(n.people),document.getElementById("post_time").innerHTML=toText(n.eventtime),document.getElementById("post_info").innerHTML=toText(n.info)}})}function toText(e){return $($.parseHTML(e)).text()}function sendMessage(){document.getElementById("summit").disabled=!0;var e={},t=!0,n=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(document.getElementById("form_email").value.match(n)?(e.email=document.getElementById("form_email").value,document.getElementById("form_email_error").innerHTML=""):(document.getElementById("form_email_error").innerHTML="Enter email an address.",t=!1),""===document.getElementById("form_message").value?(document.getElementById("form_message_error").innerHTML="Enter some information about the event.",t=!1):(e.message=document.getElementById("form_message").value,document.getElementById("form_message_error").innerHTML=""),e.event_time=document.getElementById("form_date").value+" "+document.getElementById("form_time").value,""===document.getElementById("form_count").value?(document.getElementById("form_count_error").innerHTML="Specify how many peopel can join.",t=!1):(e.people_count=document.getElementById("form_count").value,document.getElementById("form_count_error").innerHTML=""),-1==document.getElementById("form_location").value?(document.getElementById("form_location_error").innerHTML="Select a location.",t=!1):(e.location=document.getElementById("form_location").value,document.getElementById("form_location_error").innerHTML=""),t){var o=JSON.stringify(e);$.ajax({type:"post",url:"send_new.php",data:o,dataType:"json",success:function(e){e.success?(document.getElementById("messageForm").reset(),initForm(),document.getElementById("servermessage").innerHTML="",document.getElementById("summit").disabled=!1):(document.getElementById("servermessage").innerHTML=e.status,document.getElementById("summit").disabled=!1)},error:function(e){document.getElementById("servermessage").innerHTML=e.responseText}})}document.getElementById("summit").disabled=!1}function initMap(e){$.ajax({type:"get",url:"getLocation.php",data:{id:e},contentType:"application/json;charset=utf-8",success:function(e){if(e.success){var t=e.location;if(null===t);else{var n=new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(t.lat,t.lng),zoom:16}),o=new google.maps.InfoWindow,a=new google.maps.LatLng(parseFloat(t.lat),parseFloat(t.lng)),m=document.createElement("div"),r=document.createElement("strong");r.textContent=t.name,m.appendChild(r),m.appendChild(document.createElement("br"));var s=document.createElement("text");s.textContent=t.address,m.appendChild(s);var l={},i=new google.maps.Marker({map:n,position:a,label:l.label});i.addListener("click",function(){o.setContent(m),o.open(n,i)})}}}})}function initForm(){var e=new Date,t=e.getDate(),n=e.getMonth()+1,o=e.getFullYear();n<10&&(n="0"+n),t<10&&(t="0"+t);var a=o+"-"+n+"-"+t;document.getElementById("form_date").value=a;var m=document.getElementById("form_location"),r=document.createElement("option");r.value=-1,r.innerHTML="Select location",m.appendChild(r),$.ajax({type:"get",url:"locations.php",contentType:"application/json;charset=utf-8",success:function(e){for(var t=0;t<e.length;t++){var n=e[t];(r=document.createElement("option")).value=n.idlocation,r.innerHTML=n.name,m.appendChild(r)}}})}function getURLParameter(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null}$(function(){switch($("#header").load("header.html"),$("#footer").load("footer.html"),window.location.pathname){case"/":getMessages();break;case"/post.html":getMessage(getURLParameter("id"));break;case"/new.html":initForm();break;default:console.log("you are lost")}});
